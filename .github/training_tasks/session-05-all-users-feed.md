# セッション5: 全ユーザー投稿タイムライン

## 目的
- Cloud Functions の Firestore トリガーで `allUsersBooks` を同期し、他ユーザー投稿との統合タイムラインを実装する。
- クエリ条件（`banned = false`、`createsAt` 降順）とリアルタイム更新を整備する。

## 作業項目
- [ ] `allUsersBooks` 用のモデルを作成し、Repository / Provider を実装する。
- [ ] Firestore トリガー（`users/{uid}/books/{bookId}`）で `allUsersBooks` コレクションへ同期する Cloud Functions を実装する。
- [ ] 単純クエリ（自分の投稿）と複合クエリ（全ユーザー投稿）の状態管理を整理する。
- [ ] タイムライン画面を設計し、タブやセグメントボタンで自分の投稿と全体を切り替えられるようにする。
- [ ] `banned = false` のみ取得する複合クエリを実装し、適切な Firestore インデックスを作成する。
- [ ] 投稿の差分更新（例: banned フラグの変更）が UI に反映されることを確認する。

## 実装時に意識できているといいこと
- firestoreのクエリ制限を調べてみよう
- ユーザーの大量投稿時の考慮をしてみよう
- パフォーマンス計測はDevTools のを活用してみよう。

## 完了条件
- 全ユーザー投稿画面で最新の公開投稿が表示され、リアルタイム更新が動作する。
- banned フラグの変更が UI に即時反映される。(コンソールから変更でOK)
- 複合クエリの実装に必要な Firestore インデックスが作成され、デプロイ設定に反映されている。
- Firestore トリガーが `allUsersBooks` を正しく更新し、変更を確認できている。
